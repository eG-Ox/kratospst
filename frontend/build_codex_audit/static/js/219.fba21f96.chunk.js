"use strict";(self.webpackChunksistema_inventario_frontend=self.webpackChunksistema_inventario_frontend||[]).push([[219],{219(e,i,a){a.r(i),a.d(i,{default:()=>r});var t=a(555),c=a(950),n=a(429),o=a(112),s=a(414);const r=()=>{const[e,i]=(0,c.useState)([]),[a,r]=(0,c.useState)([]),[l,d]=(0,c.useState)({cliente_id:"",usuario_id:"",fecha_inicio:"",fecha_fin:""}),[h,u]=(0,c.useState)(!0),[x,j]=(0,c.useState)(""),[m,p]=(0,c.useState)(""),_=(0,n.Zp)();(0,c.useEffect)(()=>{v(),f()},[]);const v=async()=>{try{const e=await o.pK.getAll();r(e.data||[])}catch(e){console.error("Error cargando clientes:",e)}},f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{u(!0);const a=await o.DI.historial(e);i(a.data||[]),j("")}catch(a){console.error("Error cargando historial de cotizaciones:",a),j("Error al cargar historial de cotizaciones")}finally{u(!1)}},b=(0,c.useMemo)(()=>{const i=m.trim().toLowerCase();return i?e.filter(e=>{const a="".concat(e.serie||"","-").concat(e.correlativo||"").toLowerCase(),t="natural"===e.tipo_cliente?"".concat(e.cliente_nombre||""," ").concat(e.cliente_apellido||"").trim().toLowerCase():(e.razon_social||"").toLowerCase(),c=(e.accion||"").toLowerCase();return a.includes(i)||t.includes(i)||c.includes(i)||String(e.cotizacion_id||"").includes(i)}):e},[e,m]);return(0,s.jsxs)("div",{className:"historial-cotizaciones-container",children:[(0,s.jsxs)("div",{className:"historial-cotizaciones-header",children:[(0,s.jsx)("h1",{children:"Historial de Cotizaciones"}),(0,s.jsx)("input",{type:"text",placeholder:"Buscar por serie, cliente o accion",value:m,onChange:e=>p(e.target.value)})]}),(0,s.jsxs)("form",{className:"historial-cotizaciones-filtros",onSubmit:async e=>{e.preventDefault(),await f({cliente_id:l.cliente_id||void 0,usuario_id:l.usuario_id||void 0,fecha_inicio:l.fecha_inicio||void 0,fecha_fin:l.fecha_fin||void 0})},children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Cliente"}),(0,s.jsxs)("select",{value:l.cliente_id,onChange:e=>d(i=>(0,t.A)((0,t.A)({},i),{},{cliente_id:e.target.value})),children:[(0,s.jsx)("option",{value:"",children:"Todos"}),a.map(e=>(0,s.jsxs)("option",{value:e.id,children:["natural"===e.tipo_cliente?"".concat(e.nombre||""," ").concat(e.apellido||"").trim():e.razon_social," ","(",e.dni||e.ruc,")"]},"hc-".concat(e.id)))]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Usuario ID"}),(0,s.jsx)("input",{type:"text",value:l.usuario_id,onChange:e=>d(i=>(0,t.A)((0,t.A)({},i),{},{usuario_id:e.target.value}))})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Desde"}),(0,s.jsx)("input",{type:"date",value:l.fecha_inicio,onChange:e=>d(i=>(0,t.A)((0,t.A)({},i),{},{fecha_inicio:e.target.value}))})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Hasta"}),(0,s.jsx)("input",{type:"date",value:l.fecha_fin,onChange:e=>d(i=>(0,t.A)((0,t.A)({},i),{},{fecha_fin:e.target.value}))})]}),(0,s.jsxs)("div",{className:"filter-actions",children:[(0,s.jsx)("button",{type:"submit",className:"btn-primary",children:"Filtrar"}),(0,s.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{d({cliente_id:"",usuario_id:"",fecha_inicio:"",fecha_fin:""}),await f()},children:"Limpiar"})]})]}),x&&(0,s.jsx)("div",{className:"error-message",children:x}),h?(0,s.jsx)("div",{className:"loading",children:"Cargando historial..."}):(0,s.jsx)("div",{className:"historial-cotizaciones-table",children:(0,s.jsxs)("table",{children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Fecha"}),(0,s.jsx)("th",{children:"Cotizacion"}),(0,s.jsx)("th",{children:"Cliente"}),(0,s.jsx)("th",{children:"Accion"}),(0,s.jsx)("th",{children:"Usuario"}),(0,s.jsx)("th",{children:"Total"}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:0===b.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"7",className:"empty-message",children:"No hay registros."})}):b.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:new Date(e.created_at).toLocaleString()}),(0,s.jsx)("td",{children:e.serie?"".concat(e.serie,"-").concat(e.correlativo):"#".concat(e.cotizacion_id)}),(0,s.jsx)("td",{children:"natural"===e.tipo_cliente?"".concat(e.cliente_nombre||""," ").concat(e.cliente_apellido||"").trim():e.razon_social||"-"}),(0,s.jsx)("td",{children:e.accion}),(0,s.jsx)("td",{children:e.usuario_nombre||e.usuario_id||"-"}),(0,s.jsx)("td",{children:Number(e.total||0).toFixed(2)}),(0,s.jsxs)("td",{children:[(0,s.jsx)("button",{type:"button",className:"icon-btn icon-btn--view",onClick:()=>(async e=>{if(e)try{const i=await o.DI.pdf(e),a=window.URL.createObjectURL(new Blob([i.data],{type:"text/html"}));window.open(a,"_blank","noopener,noreferrer"),setTimeout(()=>window.URL.revokeObjectURL(a),2e3)}catch(i){console.error("Error abriendo PDF:",i),j("No se pudo abrir el PDF")}})(e.cotizacion_id),title:"Ver PDF","aria-label":"Ver PDF",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:(0,s.jsx)("path",{d:"M12 5c4.5 0 8.3 2.7 10 6.5C20.3 15.3 16.5 18 12 18S3.7 15.3 2 11.5C3.7 7.7 7.5 5 12 5zm0 2c-3.2 0-6 1.7-7.6 4.5C6 14.3 8.8 16 12 16s6-1.7 7.6-4.5C18 8.7 15.2 7 12 7zm0 2.5a2.5 2.5 0 1 1 0 5a2.5 2.5 0 0 1 0-5z"})})}),(0,s.jsx)("button",{type:"button",className:"icon-btn icon-btn--edit",onClick:()=>{var i;(i=e.cotizacion_id)&&_("/cotizaciones?edit=".concat(i))},title:"Editar","aria-label":"Editar",children:(0,s.jsxs)("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,s.jsx)("path",{d:"M4 17.5V20h2.5L17.9 8.6l-2.5-2.5L4 17.5z"}),(0,s.jsx)("path",{d:"M20.7 7.2a1 1 0 0 0 0-1.4l-2.5-2.5a1 1 0 0 0-1.4 0l-1.7 1.7 2.5 2.5 1.7-1.7z"})]})})]})]},e.id))})]})})]})}}}]);