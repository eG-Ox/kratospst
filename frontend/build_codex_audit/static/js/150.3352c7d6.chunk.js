"use strict";(self.webpackChunksistema_inventario_frontend=self.webpackChunksistema_inventario_frontend||[]).push([[150],{150(e,r,s){s.r(r),s.d(r,{default:()=>i});var a=s(555),c=s(950),n=s(112),t=s(218),o=s(414);const i=()=>{const e=(0,t.A)(),[r,s]=(0,c.useState)([]),[i,l]=(0,c.useState)(""),[d,u]=(0,c.useState)([]),[m,p]=(0,c.useState)(!0),[h,v]=(0,c.useState)(!1),[f,j]=(0,c.useState)(""),x=(0,c.useCallback)(async()=>{try{p(!0);const r=(await n.mc.listarRoles()).data||[];if(!e.current)return;s(r),r.length&&l(r[0].nombre),j("")}catch(r){console.error("Error cargando roles:",r),e.current&&j("Error al cargar roles")}finally{e.current&&p(!1)}},[e]),g=(0,c.useCallback)(async r=>{try{p(!0);const s=await n.mc.obtenerPorRol(r);if(!e.current)return;u(s.data||[]),j("")}catch(s){console.error("Error cargando permisos:",s),e.current&&j("Error al cargar permisos")}finally{e.current&&p(!1)}},[e]);(0,c.useEffect)(()=>{x()},[x]),(0,c.useEffect)(()=>{i&&g(i)},[i,g]);const b=(0,c.useMemo)(()=>{const e={};return d.forEach(r=>{const s=r.grupo||"General";e[s]||(e[s]=[]),e[s].push(r)}),e},[d]);return(0,o.jsxs)("div",{className:"permisos-container",children:[(0,o.jsxs)("div",{className:"permisos-header",children:[(0,o.jsx)("h1",{children:"Permisos por Rol"}),(0,o.jsxs)("div",{className:"permisos-actions",children:[(0,o.jsx)("select",{value:i,onChange:e=>l(e.target.value),children:r.map(e=>(0,o.jsx)("option",{value:e.nombre,children:e.nombre},e.id))}),(0,o.jsx)("button",{className:"btn-success",onClick:async()=>{try{v(!0),await n.mc.actualizarRol(i,{permisos:d.map(e=>({clave:e.clave,permitido:!!e.permitido}))}),e.current&&j("")}catch(r){console.error("Error guardando permisos:",r),e.current&&j("Error al guardar permisos")}finally{e.current&&v(!1)}},disabled:h,children:h?"Guardando...":"Guardar"})]})]}),f&&(0,o.jsx)("div",{className:"error-message",children:f}),m?(0,o.jsx)("div",{className:"loading",children:"Cargando permisos..."}):(0,o.jsx)("div",{className:"permisos-grid",children:Object.keys(b).map(e=>(0,o.jsxs)("div",{className:"permisos-card",children:[(0,o.jsx)("h3",{children:e}),(0,o.jsx)("div",{className:"permisos-list",children:b[e].map(e=>(0,o.jsxs)("label",{className:"permiso-item",children:[(0,o.jsx)("input",{type:"checkbox",checked:!!e.permitido,onChange:()=>{return r=e.clave,void u(e=>e.map(e=>e.clave===r?(0,a.A)((0,a.A)({},e),{},{permitido:!e.permitido}):e));var r}}),(0,o.jsx)("span",{children:e.descripcion||e.clave})]},e.clave))})]},e))})]})}},218(e,r,s){s.d(r,{A:()=>c});var a=s(950);const c=()=>{const e=(0,a.useRef)(!0);return(0,a.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}}}]);