"use strict";(self.webpackChunksistema_inventario_frontend=self.webpackChunksistema_inventario_frontend||[]).push([[182],{182(o,n,i){i.r(n),i.d(n,{default:()=>d});var e=i(555),t=i(950),l=i(112),c=i(218),a=i(414);const d=()=>{const o=(0,c.A)(),[n,i]=(0,t.useState)([]),[d,s]=(0,t.useState)({entidad:"",accion:"",usuario_id:"",fecha_inicio:"",fecha_fin:""}),[r,u]=(0,t.useState)(!0),[v,h]=(0,t.useState)(""),[x,j]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),f=(0,t.useCallback)(async()=>{try{u(!0);const n=await l.Bi.listar(d);if(!o.current)return;i(n.data||[]),h("")}catch(n){console.error("Error cargando historial:",n),o.current&&h("Error al cargar historial")}finally{o.current&&u(!1)}},[d,o]);(0,t.useEffect)(()=>{f()},[f]);const b=o=>{if(!o)return"-";try{return JSON.stringify(JSON.parse(o),null,2)}catch(v){return o}},g=(o,n)=>{let i=null,e=null;try{i=o.antes_json?JSON.parse(o.antes_json):null,e=o.despues_json?JSON.parse(o.despues_json):null}catch(v){return o.descripcion||"-"}if("movimientos"===o.entidad){var t,l,c,a,d,s,r;const o=null!==(t=null===(l=i)||void 0===l?void 0:l.stock)&&void 0!==t?t:"-",u=null!==(c=null===(a=e)||void 0===a?void 0:a.stock)&&void 0!==c?c:"-",v=null!==(d=null===(s=e)||void 0===s?void 0:s.cantidad)&&void 0!==d?d:"-",h=null!==(r=e)&&void 0!==r&&r.motivo?" | ".concat(e.motivo):"";return"antes"===n?"Stock: ".concat(o):"despues"===n?"Stock: ".concat(u," | Cant: ").concat(v).concat(h):"Stock ".concat(o," -> ").concat(u," | Cant: ").concat(v).concat(h)}if("productos"===o.entidad){var u,h,x,j,p,m;const o=(null===(u=e)||void 0===u?void 0:u.codigo)||(null===(h=i)||void 0===h?void 0:h.codigo)||"-",t=null!==(x=null===(j=i)||void 0===j?void 0:j.stock)&&void 0!==x?x:"-",l=null!==(p=null===(m=e)||void 0===m?void 0:m.stock)&&void 0!==p?p:"-";return"antes"===n?"Codigo: ".concat(o," | Stock: ").concat(t):"despues"===n?"Codigo: ".concat(o," | Stock: ").concat(l):"Codigo: ".concat(o," | Stock ").concat(t," -> ").concat(l)}if("cotizaciones"===o.entidad){var f,b,g,_,C,k,N,S,y,A,E,T,w,U,z,D,R,O,L,B;const o=null!==(f=null!==(b=null===(g=i)||void 0===g||null===(_=g.cotizacion)||void 0===_?void 0:_.total)&&void 0!==b?b:null===(C=i)||void 0===C?void 0:C.total)&&void 0!==f?f:"-",t=null!==(k=null!==(N=null===(S=e)||void 0===S||null===(y=S.cotizacion)||void 0===y?void 0:y.total)&&void 0!==N?N:null===(A=e)||void 0===A?void 0:A.total)&&void 0!==k?k:"-",l=null!==(E=null!==(T=null===(w=i)||void 0===w||null===(U=w.cotizacion)||void 0===U?void 0:U.cliente_id)&&void 0!==T?T:null===(z=i)||void 0===z?void 0:z.cliente_id)&&void 0!==E?E:"-",c=null!==(D=null!==(R=null===(O=e)||void 0===O||null===(L=O.cotizacion)||void 0===L?void 0:L.cliente_id)&&void 0!==R?R:null===(B=e)||void 0===B?void 0:B.cliente_id)&&void 0!==D?D:"-";return"antes"===n?"Cliente: ".concat(l," | Total: ").concat(o):"despues"===n?"Cliente: ".concat(c," | Total: ").concat(t):"Cliente ".concat(l," -> ").concat(c," | Total ").concat(o," -> ").concat(t)}if("clientes"===o.entidad){var J,K,F,H,I,q,M,P,V,G;const o=(null===(J=i)||void 0===J?void 0:J.dni)||(null===(K=i)||void 0===K?void 0:K.ruc)||"-",t=(null===(F=e)||void 0===F?void 0:F.dni)||(null===(H=e)||void 0===H?void 0:H.ruc)||"-",l=(null===(I=i)||void 0===I?void 0:I.razon_social)||"".concat((null===(q=i)||void 0===q?void 0:q.nombre)||""," ").concat((null===(M=i)||void 0===M?void 0:M.apellido)||"").trim(),c=(null===(P=e)||void 0===P?void 0:P.razon_social)||"".concat((null===(V=e)||void 0===V?void 0:V.nombre)||""," ").concat((null===(G=e)||void 0===G?void 0:G.apellido)||"").trim();return"antes"===n?"Doc: ".concat(o," | ").concat(l||"-"):"despues"===n?"Doc: ".concat(t," | ").concat(c||"-"):"Cliente ".concat(o," -> ").concat(t," | ").concat(l||"-"," -> ").concat(c||"-")}if("kits"===o.entidad){var Q,W,X,Y,Z,$;const o=(null===(Q=i)||void 0===Q?void 0:Q.nombre)||"-",t=(null===(W=e)||void 0===W?void 0:W.nombre)||"-",l=null!==(X=null===(Y=i)||void 0===Y?void 0:Y.precio_total)&&void 0!==X?X:"-",c=null!==(Z=null===($=e)||void 0===$?void 0:$.precio_total)&&void 0!==Z?Z:"-";return"antes"===n?"Kit: ".concat(o," | Total: ").concat(l):"despues"===n?"Kit: ".concat(t," | Total: ").concat(c):"Kit ".concat(o," -> ").concat(t," | Total ").concat(l," -> ").concat(c)}if("usuarios"===o.entidad){var oo,no,io,eo;const o=(null===(oo=i)||void 0===oo?void 0:oo.nombre)||"-",t=(null===(no=e)||void 0===no?void 0:no.nombre)||"-",l=(null===(io=i)||void 0===io?void 0:io.rol)||"-",c=(null===(eo=e)||void 0===eo?void 0:eo.rol)||"-";return"antes"===n?"Usuario: ".concat(o," | Rol: ").concat(l):"despues"===n?"Usuario: ".concat(t," | Rol: ").concat(c):"Usuario ".concat(o," -> ").concat(t," | Rol ").concat(l," -> ").concat(c)}if("tipos_maquinas"===o.entidad){var to,lo;const o=(null===(to=i)||void 0===to?void 0:to.nombre)||"-",t=(null===(lo=e)||void 0===lo?void 0:lo.nombre)||"-";return"antes"===n?"Tipo: ".concat(o):"despues"===n?"Tipo: ".concat(t):"Tipo ".concat(o," -> ").concat(t)}return o.descripcion||"-"};return(0,a.jsxs)("div",{className:"historial-container",children:[(0,a.jsxs)("div",{className:"historial-header",children:[(0,a.jsx)("h1",{children:"Historial"}),(0,a.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{try{m(!0);((o,n)=>{const i=window.URL.createObjectURL(new Blob([o])),e=document.createElement("a");e.href=i,e.setAttribute("download",n),document.body.appendChild(e),e.click(),e.remove(),window.URL.revokeObjectURL(i)})((await l.Bi.exportar(d)).data,"historial.xlsx")}catch(n){console.error("Error exportando historial:",n),o.current&&h("Error al exportar historial")}finally{o.current&&m(!1)}},disabled:p,children:p?"Exportando...":"Exportar Excel"})]}),(0,a.jsxs)("form",{className:"historial-filtros",onSubmit:o=>{o.preventDefault(),f()},children:[(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"Entidad"}),(0,a.jsxs)("select",{value:d.entidad,onChange:o=>s((0,e.A)((0,e.A)({},d),{},{entidad:o.target.value})),children:[(0,a.jsx)("option",{value:"",children:"Todas"}),(0,a.jsx)("option",{value:"productos",children:"Productos"}),(0,a.jsx)("option",{value:"movimientos",children:"Movimientos"}),(0,a.jsx)("option",{value:"clientes",children:"Clientes"}),(0,a.jsx)("option",{value:"kits",children:"Kits"}),(0,a.jsx)("option",{value:"cotizaciones",children:"Cotizaciones"}),(0,a.jsx)("option",{value:"usuarios",children:"Usuarios"})]})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"Accion"}),(0,a.jsxs)("select",{value:d.accion,onChange:o=>s((0,e.A)((0,e.A)({},d),{},{accion:o.target.value})),children:[(0,a.jsx)("option",{value:"",children:"Todas"}),(0,a.jsx)("option",{value:"crear",children:"Crear"}),(0,a.jsx)("option",{value:"editar",children:"Editar"}),(0,a.jsx)("option",{value:"eliminar",children:"Eliminar"}),(0,a.jsx)("option",{value:"ingreso",children:"Ingreso"}),(0,a.jsx)("option",{value:"salida",children:"Salida"}),(0,a.jsx)("option",{value:"toggle",children:"Toggle"})]})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"Usuario ID"}),(0,a.jsx)("input",{type:"text",value:d.usuario_id,onChange:o=>s((0,e.A)((0,e.A)({},d),{},{usuario_id:o.target.value}))})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"Desde"}),(0,a.jsx)("input",{type:"date",value:d.fecha_inicio,onChange:o=>s((0,e.A)((0,e.A)({},d),{},{fecha_inicio:o.target.value}))})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"Hasta"}),(0,a.jsx)("input",{type:"date",value:d.fecha_fin,onChange:o=>s((0,e.A)((0,e.A)({},d),{},{fecha_fin:o.target.value}))})]}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",children:"Buscar"})]}),v&&(0,a.jsx)("div",{className:"error-message",children:v}),r?(0,a.jsx)("div",{className:"loading",children:"Cargando historial..."}):(0,a.jsx)("div",{className:"historial-table-container",children:(0,a.jsxs)("table",{className:"historial-table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Fecha"}),(0,a.jsx)("th",{children:"Entidad"}),(0,a.jsx)("th",{children:"Accion"}),(0,a.jsx)("th",{children:"Usuario"}),(0,a.jsx)("th",{children:"Antes"}),(0,a.jsx)("th",{children:"Despues"}),(0,a.jsx)("th",{})]})}),(0,a.jsx)("tbody",{children:n.map(o=>(0,a.jsxs)(t.Fragment,{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:new Date(o.created_at).toLocaleString()}),(0,a.jsx)("td",{children:o.entidad}),(0,a.jsx)("td",{children:o.accion}),(0,a.jsx)("td",{children:o.usuario_nombre||o.usuario_id||"-"}),(0,a.jsx)("td",{children:g(o,"antes")}),(0,a.jsx)("td",{children:g(o,"despues")}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{className:"btn-secondary",onClick:()=>j(x===o.id?null:o.id),children:x===o.id?"Ocultar":"Ver"})})]}),x===o.id&&(0,a.jsx)("tr",{className:"historial-detalle",children:(0,a.jsx)("td",{colSpan:"7",children:(0,a.jsxs)("div",{className:"detalle-grid",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{children:"Antes"}),(0,a.jsx)("pre",{children:b(o.antes_json)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{children:"Despues"}),(0,a.jsx)("pre",{children:b(o.despues_json)})]})]})})})]},o.id))})]})})]})}},218(o,n,i){i.d(n,{A:()=>t});var e=i(950);const t=()=>{const o=(0,e.useRef)(!0);return(0,e.useEffect)(()=>(o.current=!0,()=>{o.current=!1}),[]),o}}}]);