"use strict";(self.webpackChunksistema_inventario_frontend=self.webpackChunksistema_inventario_frontend||[]).push([[732],{218(e,a,n){n.d(a,{A:()=>i});var r=n(950);const i=()=>{const e=(0,r.useRef)(!0);return(0,r.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}},732(e,a,n){n.r(a),n.d(a,{default:()=>s});var r=n(555),i=n(950),l=n(112),t=n(218),o=n(414);const c={tipo_cliente:"",dni:"",ruc:"",nombre:"",apellido:"",razon_social:"",direccion:"",telefono:"",correo:""},s=()=>{const e=(0,t.A)(),[a,n]=(0,i.useState)([]),[s,d]=(0,i.useState)(!0),[u,h]=(0,i.useState)(""),[m,x]=(0,i.useState)(""),[j,p]=(0,i.useState)(!1),[v,b]=(0,i.useState)(null),[N,f]=(0,i.useState)(c),[g,C]=(0,i.useState)(!1),[y,_]=(0,i.useState)(""),A=(0,i.useCallback)(async()=>{try{d(!0);const a=await l.pK.getAll();if(!e.current)return;n(a.data),h("")}catch(a){console.error("Error cargando clientes:",a),e.current&&h("Error al cargar clientes")}finally{e.current&&d(!1)}},[e]);(0,i.useEffect)(()=>{A()},[A]);const w=()=>{f(c),b(null),_("")},E=async()=>{if(_(""),h(""),"natural"!==N.tipo_cliente){if("juridico"===N.tipo_cliente)if(/^\d{11}$/.test(N.ruc||""))try{var a;C(!0);const i=await l.pK.consultaRuc(N.ruc);if(!e.current)return;var n;if(null!==(a=i.data)&&void 0!==a&&a.success)f(e=>(0,r.A)((0,r.A)({},e),{},{razon_social:i.data.razon_social||"",direccion:i.data.direccion||e.direccion})),_("Datos obtenidos.");else _((null===(n=i.data)||void 0===n?void 0:n.error)||"No se encontraron datos.")}catch(o){console.error("Error consultando RUC:",o),e.current&&_("Error consultando RUC.")}finally{e.current&&C(!1)}else _("El RUC debe tener 11 digitos.")}else{if(!/^\d{8}$/.test(N.dni||""))return void _("El DNI debe tener 8 digitos.");try{var i;C(!0);const a=await l.pK.consultaDni(N.dni);if(!e.current)return;var t;if(null!==(i=a.data)&&void 0!==i&&i.success)f(e=>(0,r.A)((0,r.A)({},e),{},{nombre:a.data.nombre||"",apellido:a.data.apellido||""})),_("Datos obtenidos.");else _((null===(t=a.data)||void 0===t?void 0:t.error)||"No se encontraron datos.")}catch(o){console.error("Error consultando DNI:",o),e.current&&_("Error consultando DNI.")}finally{e.current&&C(!1)}}},z=e=>"natural"===e.tipo_cliente?"DNI: ".concat(e.dni||"-"):"ce"===e.tipo_cliente?"CE: ".concat(e.dni||"-"):"RUC: ".concat(e.ruc||"-"),D=e=>"natural"===e.tipo_cliente||"ce"===e.tipo_cliente?"".concat(e.nombre||""," ").concat(e.apellido||"").trim()||"-":e.razon_social||"-",S=!!N.tipo_cliente;return(0,o.jsxs)("div",{className:"clientes-container",children:[(0,o.jsxs)("div",{className:"clientes-header",children:[(0,o.jsx)("h1",{children:"Clientes"}),(0,o.jsx)("button",{className:"btn-primary",onClick:()=>{w(),p(!0)},children:"+ Nuevo Cliente"})]}),u&&(0,o.jsx)("div",{className:"error-message",children:u}),m&&(0,o.jsx)("div",{className:"warning-message",children:m}),s?(0,o.jsx)("div",{className:"loading",children:"Cargando clientes..."}):(0,o.jsx)("div",{className:"clientes-table-container",children:a.length>0?(0,o.jsxs)("table",{className:"clientes-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Tipo"}),(0,o.jsx)("th",{children:"Documento"}),(0,o.jsx)("th",{children:"Nombre / Razon social"}),(0,o.jsx)("th",{children:"Direccion"}),(0,o.jsx)("th",{children:"Telefono"}),(0,o.jsx)("th",{children:"Correo"}),(0,o.jsx)("th",{className:"icon-col",title:"Acciones",children:(0,o.jsx)("span",{className:"icon-label","aria-label":"Acciones",children:"..."})})]})}),(0,o.jsx)("tbody",{children:a.map(a=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:"natural"===a.tipo_cliente?"Natural":"ce"===a.tipo_cliente?"CE":"Juridico"}),(0,o.jsx)("td",{children:z(a)}),(0,o.jsx)("td",{children:D(a)}),(0,o.jsx)("td",{children:a.direccion||"-"}),(0,o.jsx)("td",{children:a.telefono||"-"}),(0,o.jsx)("td",{children:a.correo||"-"}),(0,o.jsxs)("td",{className:"acciones",children:[(0,o.jsx)("button",{className:"icon-btn icon-btn--edit",onClick:()=>(e=>{b(e),f({tipo_cliente:e.tipo_cliente,dni:e.dni||"",ruc:e.ruc||"",nombre:e.nombre||"",apellido:e.apellido||"",razon_social:e.razon_social||"",direccion:e.direccion||"",telefono:e.telefono||"",correo:e.correo||""}),_(""),p(!0)})(a),title:"Editar","aria-label":"Editar",children:(0,o.jsxs)("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,o.jsx)("path",{d:"M4 17.5V20h2.5L17.9 8.6l-2.5-2.5L4 17.5z"}),(0,o.jsx)("path",{d:"M20.7 7.2a1 1 0 0 0 0-1.4l-2.5-2.5a1 1 0 0 0-1.4 0l-1.7 1.7 2.5 2.5 1.7-1.7z"})]})}),(0,o.jsx)("button",{className:"icon-btn icon-btn--delete",onClick:()=>(async a=>{if(window.confirm("Deseas eliminar este cliente?"))try{await l.pK.delete(a),await A()}catch(n){console.error("Error eliminando cliente:",n),e.current&&h("Error al eliminar cliente")}})(a.id),title:"Eliminar","aria-label":"Eliminar",children:(0,o.jsxs)("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,o.jsx)("path",{d:"M6 7h12l-1 14H7L6 7z"}),(0,o.jsx)("path",{d:"M9 7V5h6v2h4v2H5V7h4z"})]})})]})]},a.id))})]}):(0,o.jsx)("p",{className:"empty-message",children:"No hay clientes registrados"})}),j&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h2",{children:v?"Editar Cliente":"Nuevo Cliente"}),(0,o.jsx)("button",{type:"button",className:"btn-icon",onClick:()=>{w(),p(!1)},children:"X"})]}),(0,o.jsxs)("form",{onSubmit:async a=>{a.preventDefault(),h(""),x("");try{if(v)await l.pK.update(v.id,N);else{const e=await l.pK.create(N),a=(null===e||void 0===e?void 0:e.data)||{};if(null!==a&&void 0!==a&&a.ya_existia){const e=null!==a&&void 0!==a&&a.vendedor_nombre?"por ".concat(a.vendedor_nombre):"por otro vendedor";x("Cliente ya registrado ".concat(e,". Se comparti\xf3 contigo."))}}e.current&&p(!1),w(),await A()}catch(i){var n,r;if(console.error("Error guardando cliente:",i),e.current)h((null===(n=i.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.error)||"Error al guardar cliente")}},children:[(0,o.jsxs)("div",{className:"modal-body",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Tipo de cliente *"}),(0,o.jsxs)("select",{value:N.tipo_cliente,onChange:e=>{return a=e.target.value,_(""),void f(e=>(0,r.A)((0,r.A)({},e),{},{tipo_cliente:a,dni:"natural"===a||"ce"===a?e.dni:"",nombre:"natural"===a||"ce"===a?e.nombre:"",apellido:"natural"===a||"ce"===a?e.apellido:"",ruc:"juridico"===a?e.ruc:"",razon_social:"juridico"===a?e.razon_social:""}));var a},children:[(0,o.jsx)("option",{value:"",children:"Selecciona tipo"}),(0,o.jsx)("option",{value:"natural",children:"Natural (DNI)"}),(0,o.jsx)("option",{value:"juridico",children:"Juridico (RUC)"}),(0,o.jsx)("option",{value:"ce",children:"Carnet de extranjeria (CE)"})]})]}),S?"natural"===N.tipo_cliente||"ce"===N.tipo_cliente?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"ce"===N.tipo_cliente?"Carnet de extranjeria *":"DNI *"}),(0,o.jsxs)("div",{className:"consulta-row",children:[(0,o.jsx)("input",{type:"text",maxLength:"ce"===N.tipo_cliente?"9":"8",value:N.dni,onChange:e=>f((0,r.A)((0,r.A)({},N),{},{dni:e.target.value.trim()}))}),"natural"===N.tipo_cliente&&(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:E,disabled:g,children:g?"Consultando...":"Consultar"})]})]})}),(0,o.jsxs)("div",{className:"form-row",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Nombre *"}),(0,o.jsx)("input",{type:"text",value:N.nombre,onChange:e=>f((0,r.A)((0,r.A)({},N),{},{nombre:e.target.value}))})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Apellido *"}),(0,o.jsx)("input",{type:"text",value:N.apellido,onChange:e=>f((0,r.A)((0,r.A)({},N),{},{apellido:e.target.value}))})]})]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"RUC *"}),(0,o.jsxs)("div",{className:"consulta-row",children:[(0,o.jsx)("input",{type:"text",maxLength:"11",value:N.ruc,onChange:e=>f((0,r.A)((0,r.A)({},N),{},{ruc:e.target.value.trim()}))}),(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:E,disabled:g,children:g?"Consultando...":"Consultar"})]})]})}),(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Razon social *"}),(0,o.jsx)("input",{type:"text",value:N.razon_social,onChange:e=>f((0,r.A)((0,r.A)({},N),{},{razon_social:e.target.value}))})]})})]}):(0,o.jsx)("p",{className:"consulta-mensaje",children:"Selecciona el tipo de cliente para habilitar los campos."}),y&&(0,o.jsx)("p",{className:"consulta-mensaje",children:y}),(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Direccion"}),(0,o.jsx)("input",{type:"text",value:N.direccion,onChange:e=>f((0,r.A)((0,r.A)({},N),{},{direccion:e.target.value})),disabled:!S})]})}),(0,o.jsxs)("div",{className:"form-row",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Telefono"}),(0,o.jsx)("input",{type:"text",value:N.telefono,onChange:e=>f((0,r.A)((0,r.A)({},N),{},{telefono:e.target.value})),disabled:!S})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Correo"}),(0,o.jsx)("input",{type:"email",value:N.correo,onChange:e=>f((0,r.A)((0,r.A)({},N),{},{correo:e.target.value})),disabled:!S})]})]})]}),(0,o.jsxs)("div",{className:"modal-footer",children:[(0,o.jsx)("button",{type:"submit",className:"btn-success",children:v?"Guardar":"Crear"}),(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{w(),p(!1)},children:"Cancelar"})]})]})]})})]})}}}]);