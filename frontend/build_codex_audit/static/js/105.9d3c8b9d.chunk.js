"use strict";(self.webpackChunksistema_inventario_frontend=self.webpackChunksistema_inventario_frontend||[]).push([[105],{105(e,a,r){r.r(a),r.d(a,{default:()=>i});var s=r(555),l=r(950),n=r(112),t=r(218),o=r(414);const i=()=>{const e=(0,t.A)(),[a,r]=(0,l.useState)([]),[i,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(!0),[m,h]=(0,l.useState)(null),[v,x]=(0,l.useState)(!1),[j,b]=(0,l.useState)({nombre:"",email:"",rol:"ventas",activo:!0}),[p,f]=(0,l.useState)({nombre:"",email:"",contrasena:"",rol:"ventas"}),g=JSON.parse(localStorage.getItem("usuario")||"{}"),N="admin"===(null===g||void 0===g?void 0:g.rol),y=(0,l.useCallback)(async()=>{try{u(!0);const a=await n.Xg.listar();if(!e.current)return;r((a.data||[]).filter(e=>e.activo)),c("")}catch(a){console.error("Error cargando usuarios:",a),e.current&&c("Error al cargar usuarios")}finally{e.current&&u(!1)}},[e]),C=(0,l.useCallback)(async()=>{try{u(!0);const a=await n.Xg.obtenerPerfil();if(!e.current)return;b({nombre:a.data.nombre||"",email:a.data.email||"",rol:a.data.rol||"ventas",activo:!0}),c("")}catch(a){console.error("Error cargando perfil:",a),e.current&&c("Error al cargar perfil")}finally{e.current&&u(!1)}},[e]);(0,l.useEffect)(()=>{N?y():C()},[C,y,N]);const A=async a=>{a.preventDefault(),c("");try{N?(await n.Xg.actualizar(m.id,j),e.current&&h(null),await y()):(await n.Xg.actualizarPerfil({nombre:j.nombre,email:j.email}),await C())}catch(l){var r,s;if(console.error("Error guardando usuario:",l),e.current)c((null===(r=l.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.error)||"Error al guardar usuario")}};return d?(0,o.jsx)("div",{className:"loading",children:"Cargando..."}):(0,o.jsxs)("div",{className:"usuarios-container",children:[(0,o.jsxs)("div",{className:"usuarios-header",children:[(0,o.jsx)("h1",{children:N?"Usuarios":"Mi Perfil"}),N&&(0,o.jsx)("button",{type:"button",className:"btn-primary",onClick:()=>{f({nombre:"",email:"",contrasena:"",rol:"ventas"}),x(!0)},children:"+ Nuevo Usuario"})]}),i&&(0,o.jsx)("div",{className:"error-message",children:i}),N?(0,o.jsx)("div",{className:"usuarios-table-container",children:(0,o.jsxs)("table",{className:"usuarios-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Nombre"}),(0,o.jsx)("th",{children:"Usuario"}),(0,o.jsx)("th",{children:"Rol"}),(0,o.jsx)("th",{children:"Estado"}),(0,o.jsx)("th",{className:"icon-col",title:"Acciones",children:(0,o.jsx)("span",{className:"icon-label","aria-label":"Acciones",children:"..."})})]})}),(0,o.jsx)("tbody",{children:a.map(a=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:a.nombre}),(0,o.jsx)("td",{children:a.email}),(0,o.jsx)("td",{children:a.rol}),(0,o.jsx)("td",{children:a.activo?"Activo":"Inactivo"}),(0,o.jsxs)("td",{children:[(0,o.jsx)("button",{className:"icon-btn icon-btn--edit",onClick:()=>(e=>{h(e),b({nombre:e.nombre||"",email:e.email||"",rol:e.rol||"ventas",activo:!!e.activo})})(a),title:"Editar","aria-label":"Editar",children:(0,o.jsxs)("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,o.jsx)("path",{d:"M4 17.5V20h2.5L17.9 8.6l-2.5-2.5L4 17.5z"}),(0,o.jsx)("path",{d:"M20.7 7.2a1 1 0 0 0 0-1.4l-2.5-2.5a1 1 0 0 0-1.4 0l-1.7 1.7 2.5 2.5 1.7-1.7z"})]})}),(0,o.jsx)("button",{className:"icon-btn icon-btn--delete",onClick:()=>(async a=>{const r=a.activo?"desactivar":"activar";if(window.confirm("Deseas ".concat(r," a ").concat(a.nombre,"?")))try{await n.Xg.actualizar(a.id,{nombre:a.nombre,email:a.email,telefono:a.telefono||"",rol:a.rol,activo:!a.activo}),await y()}catch(t){var s,l;console.error("Error cambiando estado de usuario:",t),e.current&&c((null===(s=t.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.error)||"Error al actualizar usuario")}})(a),title:a.activo?"Desactivar":"Activar","aria-label":a.activo?"Desactivar":"Activar",children:(0,o.jsxs)("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,o.jsx)("path",{d:"M6 7h12l-1 14H7L6 7z"}),(0,o.jsx)("path",{d:"M9 7V5h6v2h4v2H5V7h4z"})]})})]})]},a.id))})]})}):(0,o.jsxs)("form",{className:"perfil-form",onSubmit:A,children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Nombre"}),(0,o.jsx)("input",{type:"text",value:j.nombre,onChange:e=>b((0,s.A)((0,s.A)({},j),{},{nombre:e.target.value}))})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Email"}),(0,o.jsx)("input",{type:"text",value:j.email,onChange:e=>b((0,s.A)((0,s.A)({},j),{},{email:e.target.value}))})]}),(0,o.jsx)("button",{type:"submit",className:"btn-success",children:"Guardar cambios"})]}),m&&N&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content modal-sm",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h2",{children:"Editar Usuario"}),(0,o.jsx)("button",{type:"button",className:"btn-icon",onClick:()=>h(null),children:"X"})]}),(0,o.jsxs)("form",{onSubmit:A,children:[(0,o.jsxs)("div",{className:"modal-body",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Nombre"}),(0,o.jsx)("input",{type:"text",value:j.nombre,onChange:e=>b((0,s.A)((0,s.A)({},j),{},{nombre:e.target.value}))})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Email"}),(0,o.jsx)("input",{type:"text",value:j.email,onChange:e=>b((0,s.A)((0,s.A)({},j),{},{email:e.target.value}))})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Rol"}),(0,o.jsxs)("select",{value:j.rol,onChange:e=>b((0,s.A)((0,s.A)({},j),{},{rol:e.target.value})),children:[(0,o.jsx)("option",{value:"admin",children:"admin"}),(0,o.jsx)("option",{value:"ventas",children:"ventas"}),(0,o.jsx)("option",{value:"logistica",children:"logistica"})]})]})]}),(0,o.jsxs)("div",{className:"modal-footer",children:[(0,o.jsx)("button",{type:"submit",className:"btn-success",children:"Guardar"}),(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>h(null),children:"Cancelar"})]})]})]})}),v&&N&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content modal-sm",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h2",{children:"Crear Usuario"}),(0,o.jsx)("button",{type:"button",className:"btn-icon",onClick:()=>x(!1),children:"X"})]}),(0,o.jsxs)("form",{onSubmit:async a=>{a.preventDefault(),c("");try{await n.y1.registro({nombre:p.nombre,email:p.email,contrasena:p.contrasena,rol:p.rol}),e.current&&x(!1),await y()}catch(l){var r,s;if(console.error("Error creando usuario:",l),e.current)c((null===(r=l.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.error)||"Error al crear usuario")}},autoComplete:"off",children:[(0,o.jsxs)("div",{className:"modal-body",children:[(0,o.jsx)("input",{type:"text",name:"fakeuser",autoComplete:"username",style:{display:"none"}}),(0,o.jsx)("input",{type:"password",name:"fakepass",autoComplete:"new-password",style:{display:"none"}}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Nombre"}),(0,o.jsx)("input",{type:"text",name:"nuevo-nombre",autoComplete:"off",value:p.nombre,onChange:e=>f((0,s.A)((0,s.A)({},p),{},{nombre:e.target.value}))})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Email *"}),(0,o.jsx)("input",{type:"email",name:"nuevo-email",autoComplete:"email",required:!0,value:p.email,onChange:e=>f((0,s.A)((0,s.A)({},p),{},{email:e.target.value.trim()})),placeholder:"usuario@dominio.com"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Contrasena"}),(0,o.jsx)("input",{type:"password",name:"nuevo-contrasena",autoComplete:"new-password",value:p.contrasena,onChange:e=>f((0,s.A)((0,s.A)({},p),{},{contrasena:e.target.value}))})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"Rol"}),(0,o.jsxs)("select",{value:p.rol,onChange:e=>f((0,s.A)((0,s.A)({},p),{},{rol:e.target.value})),children:[(0,o.jsx)("option",{value:"admin",children:"admin"}),(0,o.jsx)("option",{value:"ventas",children:"ventas"}),(0,o.jsx)("option",{value:"logistica",children:"logistica"})]})]})]}),(0,o.jsxs)("div",{className:"modal-footer",children:[(0,o.jsx)("button",{type:"submit",className:"btn-success",children:"Crear"}),(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>x(!1),children:"Cancelar"})]})]})]})})]})}},218(e,a,r){r.d(a,{A:()=>l});var s=r(950);const l=()=>{const e=(0,s.useRef)(!0);return(0,s.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}}}]);